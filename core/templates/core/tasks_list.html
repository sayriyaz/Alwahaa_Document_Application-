{% extends "core/base.html" %}
{% block content %}
<h2>Tasks</h2>

<form method="get" style="margin-bottom:12px">
  <label>Status:</label>
  <select name="status">
    <option value="">All</option>
    <option value="not_started" {% if status_filter == 'not_started' %}selected{% endif %}>Not Started</option>
    <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>In Progress</option>
    <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
  </select>

  <label>Assigned to:</label>
  <select name="assigned_to">
    <option value="">All</option>
    {% for user in assigned_users %}
      <option value="{{ user.username }}" {% if assigned_to_filter == user.username %}selected{% endif %}>{{ user.username }}</option>
    {% endfor %}
  </select>
  <button type="submit">Filter</button>
</form>

<table>
  <tr><th>Title</th><th>Request</th><th>Assigned</th><th>Status</th><th>Due</th></tr>
  {% for t in tasks %}
  <tr>
    <td>{{ t.title }}</td>
    <td>{{ t.service_request.company.name }} â€“ {{ t.service_request.service_type.name }}</td>
    <td>{{ t.assigned_to.username }}</td>
    <td>
      {% if t.status == 'completed' %}
        <span class="badge green">Completed</span>
      {% elif t.status == 'in_progress' %}
        <span class="badge orange">In Progress</span>
      {% else %}
        <span class="badge red">Not Started</span>
      {% endif %}
    </td>
    <td>{{ t.due_date }}</td>
  </tr>
  {% empty %}<tr><td colspan="5">No tasks</td></tr>{% endfor %}
</table>

<h3>Add Task</h3>
<form method="post">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit">Save</button>
</form>
{% endblock %}
